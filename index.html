<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sushi Ordination</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header>
    <div class="container-title">
      <p class="title">Sushi <br> Ordination</p>
    </div>
  </header>

  <!-- MAIN CON TABELLA -->
  <main>

    <div id="container-table" class="container-table">
      <table id="table">
        <tr>
          <th>Numero</th>
          <th>Quantit√†</th>
        </tr>
      </table>
    </div>

    <!-- aggiunge uno spazio della stessa dimensione dell'area bottoni -->
    <div class="space-bottom"></div>
  </main>

  <!-- AREA BOTTONI -->
  <div class="container-buttons">
    <!-- <div id="container-buttons" class="container-buttons"> -->

    <div id="container-btn-add" class="container-btn-add">
      <button id="btn-add" class="btn-add" type="submit" onclick="aggiungi()">Aggiungi</button>
    </div>
    <div id="container-input" class="container-input">
      <input type="number" id="text" placeholder="Numero">
    </div>
    <div id="container-btn-rem" class="container-btn-rem hide">
      <button class="btn-rem" type="submit" onclick="elimina()">Rimuovi</button>
    </div>

    <!-- </div> -->
  </div>

  <script>
    // aggiunge :active al touchscreen
    window.onload = function () {
      if (/iP(hone|ad)/.test(window.navigator.userAgent)) {
        document.body.addEventListener('touchstart', function () { }, false);
      }
    }

    // controlla che input abbia strettamente un numero al suo interno
    function checkText() {
      var input = document.getElementById("text");
      if (input.value != "") {
        if (input.value <= 0)
          alert("Il numero deve essere maggiore di 0");
        else
          return 1;
      }
      else {
        alert("Inserisci un numero üò¨");
        input.focus();
        input.value = "";
        return 0;
      }
    }

    // SE il numero non √® gi√† nella tabella aggiunge una nuova riga
    // ALTRIMENTI incrementa la quantit√†
    function aggiungi() {
      if (checkText()) {
        var table = document.getElementById("table");
        var input = document.getElementById("text");
        var check = false;

        // controlla che il numero sia nella tabella per incrementarlo altrimenti esce e lo aggiunge alla tabella
        for (var j = 1; j < table.rows.length; j++) {
          var cellNum = table.rows[j].cells[0]; // preleva il numero dalla tabella
          var cellQua = table.rows[j].cells[1]; // preleva la quantit√† dalla tabella

          if (cellNum.innerHTML == input.value) {
            ++cellQua.innerHTML;
            check = true;
            input.focus();
            input.value = "";
          }
        }

        // aggiunge in tabella una nuova riga con i nuovi dati
        if (!check) {
          var i = table.rows.length; // preleva il numero di righe della tabella
          var row = table.insertRow(i);
          var cellNum = row.insertCell(0).innerHTML = input.value;
          var cellQuantity = row.insertCell(1).innerHTML = 1;

          input.focus();
          input.value = "";

          // se c'√® almeno una riga con dei numeri allora mostra la tabella e il bottone rimuovi 
          if (i == 1) {
            //mostro la tabella e il bottone rimuovi se esiste almeno una riga + gestione animazione con timer
            setTimeout(() => {
              document.getElementById("container-btn-rem").classList.add("show"); // mostra btn-rem
              document.getElementById("container-btn-rem").classList.remove("hide");
            }, 300);
            // animazione bottoni
            document.getElementById("container-btn-add").style.width = "calc(100%/3)";
            document.getElementById("container-input").style.width = "calc(100%/3)";
          }
        }
      }
    }

    // SE il numero √® nella tabella decrementa la quantit√† di 1 
    // SE la quantit√† = 0 nasconde la tabella e il tasto rimuovi
    function elimina() {
      if (checkText()) {
        var table = document.getElementById("table");
        var input = document.getElementById("text");
        var check = false;

        // cerca se il numero √® presente nella tabella 
        for (var j = 1; j < table.rows.length; j++) {
          var cellNum = table.rows[j].cells[0];
          var cellQua = table.rows[j].cells[1];

          // se √® presente decrementa la quantit√†
          if (cellNum.innerHTML == input.value) {
            check = true;
            --cellQua.innerHTML;
            // se la quantit√† di un numero √® 0 allora toglie la riga dalla tabella
            if (cellQua.innerHTML == 0)
              table.rows[j].remove();
            input.focus();
            input.value = "";
          }
        }

        if (!check) {
          alert("Numero non presente nella tabella ü§∑üèª‚Äç‚ôÇÔ∏è");
          input.focus();
          input.value = "";
        }

        // se non ci sono pi√π elementi nella tabella, nasconde sia la tabella che il tasto rimuovi
        var i = table.rows.length;
        if (i == 1) {
          // nascondo la tabella e il bottone rimuovi se non esiste nessun elemento nella tabella
          document.getElementById("container-btn-rem").classList.remove("show");
          document.getElementById("container-btn-rem").classList.add("hide");
          setTimeout(() => {
            document.getElementById("container-btn-add").style.width = "calc(100%/2)";
            document.getElementById("container-input").style.width = "calc(100%/2)";
          }, 300);
        }
      }
    }
  </script>

</body>

</html>